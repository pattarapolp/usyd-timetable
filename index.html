<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USYD Timetable Planner</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: white;
      color: #111;
    }

    header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #e5e5e5;
    }

    header h1 {
      margin: 0;
      font-size: 28px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
    }

    button {
      padding: 8px 14px;
      border: 1px solid #ccc;
      background: #f9f9f9;
      cursor: pointer;
      border-radius: 6px;
    }

    button:hover {
      background: #eee;
    }

    .timetable-wrapper {
      overflow-x: auto;
      padding: 10px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 900px;
    }

    th, td {
      border: 1px solid #ddd;
      text-align: center;
      padding: 6px;
      height: 32px;
      cursor: pointer;
    }

    th {
      background: #f5f5f5;
      font-weight: bold;
      cursor: default;
    }

    td.time {
      background: #fafafa;
      font-weight: bold;
      cursor: default;
      width: 80px;
    }

    .login {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .login-box {
      background: white;
      padding: 25px;
      border-radius: 10px;
      width: 280px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
    }

    .login-box input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<div id="loginScreen" class="login">
  <div class="login-box">
    <h2>Login</h2>
    <p>Enter a username to save your timetable</p>
    <input id="usernameInput" placeholder="Username" />
    <button onclick="login()">Login</button>
  </div>
</div>

<header>
  <h1>USYD Timetable</h1>
</header>

<div class="controls">
  <button onclick="changeWeek(-1)">← Previous Week</button>
  <span id="weekLabel">Week 1</span>
  <button onclick="changeWeek(1)">Next Week →</button>
</div>

<div class="timetable-wrapper">
  <table id="timetable"></table>
</div>

<script>
  const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
  const startHour = 8;
  const endHour = 20;
  const interval = 30;

  let currentWeek = 1;
  let user = null;

  // ===== SUBJECT COLOR SYSTEM =====
  function getSubjectColors() {
    return JSON.parse(localStorage.getItem(`${user}-subjectColors`) || '{}');
  }

  function saveSubjectColors(colors) {
    localStorage.setItem(`${user}-subjectColors`, JSON.stringify(colors));
  }

  function getColorForSubject(subject) {
    const colors = getSubjectColors();
    if (colors[subject]) return colors[subject];

    const hue = Math.floor(Math.random() * 360);
    const color = `hsl(${hue}, 70%, 85%)`;
    colors[subject] = color;
    saveSubjectColors(colors);
    return color;
  }

  function buildTable() {
    const table = document.getElementById('timetable');
    table.innerHTML = '';

    const headerRow = document.createElement('tr');
    headerRow.appendChild(document.createElement('th'));

    days.forEach(day => {
      const th = document.createElement('th');
      th.textContent = day;
      headerRow.appendChild(th);
    });

    table.appendChild(headerRow);

    for (let h = startHour; h < endHour; h++) {
      for (let m = 0; m < 60; m += interval) {
        const row = document.createElement('tr');

        const timeCell = document.createElement('td');
        timeCell.className = 'time';
        timeCell.textContent = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
        row.appendChild(timeCell);

        days.forEach(day => {
          const cell = document.createElement('td');
          const key = `${user}-week${currentWeek}-${day}-${h}-${m}`;
          const saved = localStorage.getItem(key);

          if (saved) {
            cell.textContent = saved;
            cell.style.backgroundColor = getColorForSubject(saved);
          }

          cell.onclick = () => editCell(cell, key);
          row.appendChild(cell);
        });

        table.appendChild(row);
      }
    }
  }

  function editCell(cell, key) {
    const value = prompt('Enter subject name:', cell.textContent);
    if (value === null) return;

    if (value.trim() === '') {
      cell.textContent = '';
      cell.style.backgroundColor = '';
      localStorage.removeItem(key);
    } else {
      cell.textContent = value;
      cell.style.backgroundColor = getColorForSubject(value);
      localStorage.setItem(key, value);
    }
  }

  function changeWeek(delta) {
    currentWeek = Math.max(1, currentWeek + delta);
    document.getElementById('weekLabel').textContent = `Week ${currentWeek}`;
    buildTable();
  }

  function login() {
    const input = document.getElementById('usernameInput');
    if (!input.value.trim()) return;
    user = input.value.trim();
    localStorage.setItem('usydUser', user);
    document.getElementById('loginScreen').classList.add('hidden');
    buildTable();
  }

  window.onload = () => {
    const savedUser = localStorage.getItem('usydUser');
    if (savedUser) {
      user = savedUser;
      document.getElementById('loginScreen').classList.add('hidden');
      buildTable();
    }
  };
</script>

</body>
</html>
