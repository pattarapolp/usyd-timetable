<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>USYD Timetable Planner</title>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: white;
  color: #111;
}

header {
  padding: 20px;
  text-align: center;
  border-bottom: 1px solid #e5e5e5;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin: 15px;
}

button {
  padding: 8px 14px;
  border: 1px solid #ccc;
  background: #f9f9f9;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #eee;
}

.legend {
  max-width: 900px;
  margin: 0 auto 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  font-size: 14px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
}

.legend-color {
  width: 16px;
  height: 16px;
  border-radius: 4px;
}

.timetable-wrapper {
  overflow-x: auto;
  padding: 10px;
}

table {
  border-collapse: collapse;
  width: 100%;
  min-width: 850px;
}

th, td {
  border: 1px solid #ddd;
  text-align: center;
  padding: 6px;
  height: 32px;
}

th {
  background: #f5f5f5;
}

td.time {
  background: #fafafa;
  font-weight: bold;
  width: 80px;
}

.login {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
}

.login-box {
  background: white;
  padding: 25px;
  border-radius: 10px;
  width: 280px;
  text-align: center;
}

.hidden { display: none; }

@media (max-width: 600px) {
  th, td { font-size: 12px; padding: 4px; }
}
</style>
</head>

<body>

<div id="loginScreen" class="login">
  <div class="login-box">
    <h2>Login</h2>
    <input id="usernameInput" placeholder="Username" />
    <button onclick="login()">Login</button>
  </div>
</div>

<header>
  <h1>USYD Timetable</h1>
</header>

<div class="controls">
  <button onclick="changeWeek(-1)">← Previous</button>
  <span id="weekLabel">Week 1</span>
  <button onclick="changeWeek(1)">Next →</button>
  <button onclick="copyWeek()">Copy Previous Week</button>
</div>

<div class="legend" id="legend"></div>

<div class="timetable-wrapper">
  <table id="timetable"></table>
</div>

<script>
const days = ['Monday','Tuesday','Wednesday','Thursday','Friday'];
const startHour = 8, endHour = 20, interval = 30;
const palette = ['#dbeafe','#ede9fe','#dcfce7','#cffafe','#fce7f3','#fef9c3'];

let currentWeek = 1;
let user = null;

function getColors() {
  return JSON.parse(localStorage.getItem(user+'-colors') || '{}');
}
function saveColors(c){ localStorage.setItem(user+'-colors',JSON.stringify(c)); }

function colorFor(subject) {
  const colors = getColors();
  if (!colors[subject]) {
    colors[subject] = palette[Object.keys(colors).length % palette.length];
    saveColors(colors);
  }
  return colors[subject];
}

function updateLegend() {
  const legend = document.getElementById('legend');
  legend.innerHTML = '';
  const colors = getColors();
  Object.keys(colors).forEach(s => {
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `<div class="legend-color" style="background:${colors[s]}"></div>${s}`;
    legend.appendChild(item);
  });
}

function buildTable() {
  const table = document.getElementById('timetable');
  table.innerHTML = '';
  updateLegend();

  const head = document.createElement('tr');
  head.appendChild(document.createElement('th'));
  days.forEach(d => { const th=document.createElement('th'); th.textContent=d; head.appendChild(th); });
  table.appendChild(head);

  for (let h=startHour; h<endHour; h++) {
    for (let m=0; m<60; m+=interval) {
      const row = document.createElement('tr');
      const time = document.createElement('td');
      time.className='time';
      time.textContent=`${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
      row.appendChild(time);

      days.forEach(day=>{
        const cell=document.createElement('td');
        const key=`${user}-w${currentWeek}-${day}-${h}-${m}`;
        const val=localStorage.getItem(key);
        if(val){ cell.textContent=val; cell.style.background=colorFor(val); }
        cell.onclick=()=>edit(cell,key);
        cell.oncontextmenu=e=>{ e.preventDefault(); clear(cell,key); };
        row.appendChild(cell);
      });
      table.appendChild(row);
    }
  }
}

function edit(cell,key){
  const v=prompt('Subject:',cell.textContent);
  if(v===null) return;
  if(!v.trim()) return clear(cell,key);
  cell.textContent=v;
  cell.style.background=colorFor(v);
  localStorage.setItem(key,v);
  updateLegend();
}

function clear(cell,key){
  cell.textContent='';
  cell.style.background='';
  localStorage.removeItem(key);
}

function copyWeek(){
  if(currentWeek===1) return;
  days.forEach(day=>{
    for(let h=startHour;h<endHour;h++){
      for(let m=0;m<60;m+=interval){
        const prev=`${user}-w${currentWeek-1}-${day}-${h}-${m}`;
        const curr=`${user}-w${currentWeek}-${day}-${h}-${m}`;
        const val=localStorage.getItem(prev);
        if(val) localStorage.setItem(curr,val);
      }
    }
  });
  buildTable();
}

function changeWeek(d){
  currentWeek=Math.max(1,currentWeek+d);
  document.getElementById('weekLabel').textContent='Week '+currentWeek;
  buildTable();
}

function login(){
  const u=document.getElementById('usernameInput').value.trim();
  if(!u) return;
  user=u;
  localStorage.setItem('usydUser',u);
  document.getElementById('loginScreen').classList.add('hidden');
  buildTable();
}

window.onload=()=>{
  const u=localStorage.getItem('usydUser');
  if(u){ user=u; document.getElementById('loginScreen').classList.add('hidden'); buildTable(); }
};
</script>

</body>
</html>
